<page-title title="Photo Requests" subtitle="Requests list"></page-title>

<!-- Main content -->
<section class="content">
	<div class="container-fluid">


    <div *ngIf="error_message.length > 0" class="alert alert-danger text-center w-100" role="alert" style="position: fixed; top: 20px; z-index: 1051;">
      {{ error_message }}
    </div>

    <!-- Success Message -->
    <div *ngIf="success_message.length > 0" class="alert alert-success text-center w-100" role="alert" style="position: fixed; top: 20px; z-index: 1050;">
      {{ success_message }}
    </div>

		<div class="row">
			<div class="col-12">
				<div class="card">

					<!-- /.card-header -->
					<div class="card-body row">

						<div class="col-3 float-start  mb-3">
							<search-box (search)="onSearch($event)"></search-box>
						</div>

						<div class="table table-striped" style="padding-top: 20px; display: flex;width: 100%;flex-direction: column;">
							<div class="table-light" style="width: 100%;">
								<div style="display: flex;justify-content: space-between;width: 100%;">
									<div style="width: 20%;padding-left: 14px;">
										<sortable style="font-size: medium;" (toggle)="onSort($event)" caption="Request Photo"  name="Request"></sortable>
									</div>
                  <!-- <th></th> -->
                  <div style="width: 25%;padding-left: 40px;">
                    <sortable style="font-size: medium;" (toggle)="onSort($event)" caption="KYC ID Proof" name="ReqInfo">
                    </sortable>
                  </div>
                  <div style="width: 45%;padding-left: 0px;">
                    <sortable style="font-size: medium;" (toggle)="onSort($event)" caption="Avatars" name="Avatars">
                    </sortable>
                  </div>
									<!-- <th class="w-10">
										{{ "Actions" }}
									</th> -->
                  <div style="width: 15%;">
                    <sortable style="font-size: medium;" (toggle)="onSort($event)" caption="Actions" name="ReqInfo">
                    </sortable>
                  </div>
  
								</div>
							</div>
							<div>
                
                <div *ngFor="let one of records;" style="display: flex; width: 100%;padding-top: 30px; border: 1px solid black;">
                  <form style="display: flex;justify-content: space-evenly;width: 100%;" (ngSubmit)="saveChanges(one.id)" >
                  <!-- USER PHOTO -->
                  <div style="width: 21%;display: flex; padding-left: 0px;">

                    <div style="display: flex;flex-direction: column;">
                    <div style="display: flex; justify-content: center;align-items: center;">

                    <div>
                    <div class="position-relative" style="display: flex;flex-direction: column;">
                      <small>User Photo</small>
                      <img style="width: 128px; height: 128px; " src="{{ one.photo }}" />
                    </div>
                    <div *ngIf="one.photo" >
                      <a target="_blank" href="{{ one.photo }}">
                      <span><i class="fa fa-download " style="padding-right: 10px" ></i> </span>
                      </a>
                    </div>
                  </div>

                  <div style="margin-left: 10px;">
                    <div class="btn"
                        [ngClass]="{
                            'btn-gray': !one.face_status || one.face_status === 'Pending', 
                            'btn-danger': one.face_status === 'Rejected',
                            'btn-success': one.face_status === 'Approved'
                        }"
                        style="width: 100px;font-size: 13px;"
                        *ngIf="isEditing !== one.id">
                      {{ one.face_status ?? 'Pending' }}
                    </div>

                    <select class="form-control btn btn-primary"
                            id="dropdownMenuSelect"
                            style="width: 105px; color: white; border: 1px solid #ced4da;font-size: 13px;"
                            *ngIf="isEditing === one.id"
                            (change)="onFaceStatusChange($event)">
                        <option value="" disabled selected>Select Status</option>
                        <option value="Rejected">Rejected</option>
                        <option value="Approved">Approved</option>
                    </select>

                  </div>
                               
                  

                  </div>

                  <div style="padding-top: 20px;">
                    <form [formGroup]="artistForm">
                      <div class="form-group" >
                        <label for="realName">Real Name</label>
                        <input type="text" class="form-control" style="width: 220px;" id="realName" formControlName="real_name" *ngIf="isEditing === one.id"/>
                        <!-- Read-only display -->
                        <input type="text" class="form-control" style="width: 220px;" id="realName" [value]="one.real_name" readonly *ngIf="isEditing !== one.id"/>
                      </div>
                      <div class="form-group">
                        <label for="nickname">Nickname</label>
                        <input type="text" class="form-control" style="width: 220px;" id="nickname" formControlName="nickname" *ngIf="isEditing === one.id"/>
                        <!-- Read-only display -->
                        <input type="text" class="form-control" style="width: 220px;" id="nickname" [value]="one.nickname" readonly *ngIf="isEditing !== one.id"/>
                      </div>
                    </form>
                  </div>
                  

                </div>

                  </div>

                  <!-- KYC ID PROOF -->
                  <div style="display: flex;width: 19%;padding-left: 10px;border-left: 1px solid gray;">

                    <div style="width: 160px;">
                      <div class="position-relative">
                        <small>ID Photo</small>
                        <img style="width: 128px; height: 128px; cursor: pointer; " src="{{ one.id_photo }}" (click)="setImage(one.id_photo)"  data-toggle="modal" data-target="#myModal"  />
                      </div>
                      <div *ngIf="one.photo" >
                        <a target="_blank" href="{{ one.id_photo }}">
                        </a>
                      </div>

                      <div style="padding-top: 30px;">
                        <div style="width: 100px;font-size: 13px;"
                            class="btn"
                            [ngClass]="{
                                'btn-secondary': one.id_status === 'Pending' || !one.id_status,
                                'btn-danger': one.id_status === 'Rejected',
                                'btn-success': one.id_status === 'Approved'
                            }">
                          {{ one.id_status ?? 'Pending' }}
                        </div>


                        <div class="dropup" style="margin-top: 20px;">
                          <button *ngIf="isEditing != one.id" class="dropdown-toggle" type="button" id="dropdownMenuButton" style="background: none; border: none; display: flex; align-items: center;">
                            <img [src]="one.file" alt="{{ one.country }}" style="width: 32px; height: 32px;" />
                            <span style="font-weight: 400; margin-left: 10px;" >{{ one.country ?? 'Not Selected' }}</span>
                          </button>
                          <div class="dropdown" [ngClass]="{ 'show': isDropdownOpen }" *ngIf="isEditing === one.id">
                            <button class="btn  dropdown-toggle" type="button" (click)="toggleDropdown()" style="border: 1px solid gray;">
                              <img [src]="artistForm.value.flag" class="me-2" style="width: 24px; height: 24px;">
                              {{ artistForm.value.country || 'Select a country' }}
                            </button>
                            <div class="dropdown-menu show" *ngIf="isDropdownOpen">
                              <!-- Fixed Search Bar -->
                              <div class="px-3 py-2">
                                <input type="text" class="form-control" placeholder="Search country..." (input)="filterCountries($event)">
                              </div>
                              <!-- Scrollable List -->
                              <div class="dropdown-list">
                                <ul class="list-unstyled m-0 p-0">
                                  <li *ngFor="let country of filteredFlags" class="dropdown-item" (click)="selectCountry(country.country, country.flag)">
                                    <img [src]="country.flag" alt="{{ country.country }}" class="me-2" style="width: 24px; height: 24px;">
                                    {{ country.country }}
                                  </li>
                                </ul>
                              </div>
                            </div>
                          </div>
                          
                        </div>  
                        
                        
                      </div>

                    </div>
                    
                    
                  </div> 
                  
                  <!-- AVATARS VIEW -->
                  <div style="width: 45%; padding-left: 0;display: flex;justify-content: space-evenly;border-left: 1px solid gray;">
                  <div  style="width: 160px;  float: left;">
                    <div class="position-relative float-left">
                      <small>Main</small>
                      <div *ngIf="one.avatar" >


                        <app-image-upload (imagesUploaded)="onImagesUploaded(one.id, '0', $event)"></app-image-upload>

                        <a target="_blank" href="{{ one.avatar }}">
                          <img class="img-old" style="width: 128px; height: 128px; " src="{{ one.avatar }}" />
                        </a>


                      </div>

                      <div *ngIf="! one.avatar" >
                        <div class="position-relative float-left " style=" height: 128px; width: 128px">
                          <app-image-upload (imagesUploaded)="onImagesUploaded(one.id, '0', $event)"></app-image-upload>
                        </div>
                        <span><i class="fa fa-download " style=" color: transparent;padding-right: 10px" ></i> </span>
                      </div>
                    </div>

                  </div>


                  <div  style="width: 160px;  float: left;">
                    <div class="position-relative float-left">
                      <small>Lobby</small>
                      <div *ngIf="one.avatar2" >

                        <app-image-upload (imagesUploaded)="onImagesUploaded(one.id, '1', $event)"></app-image-upload>

                        <a target="_blank" href="{{ one.avatar2 }}">
                          <img class="img-old" style="width: 128px; height: 128px; " src="{{ one.avatar2 }}" />
                        </a>
                      </div>

                      <div *ngIf="! one.avatar2" >
                        <div class="position-relative float-left " style=" height: 128px; width: 128px">
                          <app-image-upload (imagesUploaded)="onImagesUploaded(one.id, '1', $event)"></app-image-upload>
                        </div>
                        <span><i class="fa fa-download " style=" color: transparent; padding-right: 10px" ></i> </span>
                      </div>
                    </div>

                  </div>



                  <div  style="width: 160px;  float: left;">
                    <div class="position-relative float-left">
                      <small>Detail</small>
                      <div *ngIf="one.avatar3" >

                        <app-image-upload (imagesUploaded)="onImagesUploaded(one.id, '2', $event)"></app-image-upload>

                        <a target="_blank" href="{{ one.avatar3 }}">
                          <img class="img-old" style="width: 128px; height: 128px; " src="{{ one.avatar3 }}" />
                        </a>

                      </div>

                      <div *ngIf="! one.avatar3" >
                        <div class="position-relative float-left " style="height: 128px; width: 128px">
                          <app-image-upload (imagesUploaded)="onImagesUploaded(one.id, '2', $event)"></app-image-upload>
                        </div>
                        <span><i class="fa fa-download " style=" color: transparent; padding-right: 10px" ></i> </span>
                      </div>
                    </div>

                  </div>
                </div>

                <!-- ACTIONS -->
                <div style="width: 15%; display: flex; justify-content: center; align-items: center; padding-left: 10px; padding-right: 5px;flex-direction: column;border-left: 1px solid gray;">
                  <button type="button" class="btn btn-primary" style="width: 150px;" (click)="enableEdit(one.id)" *ngIf="isEditing != one.id">
                    Edit
                  </button>
                  <button type="submit" class="btn btn-primary" style="width: 150px;text-align:center;" *ngIf="isEditing===one.id">
                    Save Changes
                  </button>
                  <button class="btn btn-primary" type="button" *ngIf="isEditing === one.id" style="width: 150px;margin-top: 10px;" (click)="closeEdit()" >Cancel</button>
                </div>
                

              </form>
                </div>

                <div>
                  
                </div>


                <div *ngIf="!records || records.length < 1">
                  <div colspan="6" >No record found</div>
                </div>
							</div>
						</div>


						<mat-paginator (page)="handlePageEvent($event)" [length]="pageOptions.pageEvents.length"
							[pageSize]="pageOptions.pageEvents.pageSize" [pageSizeOptions]="pageOptions.sizeOptions"
							aria-label="Select page">
						</mat-paginator>


					</div>
					<!-- /.card-body -->
				</div>
				<!-- /.card -->

			</div>
			<!-- /.col -->
		</div>
		<!-- /.row -->
	</div>
	<!-- /.container-fluid -->
</section>
<!-- /.content -->

                    <!-- POPUP MODAL -->
<app-popup *ngIf="isEditing != null" [file]="artistForm.value.file" (statusSelected)="handleStatusSelected($event)"></app-popup>